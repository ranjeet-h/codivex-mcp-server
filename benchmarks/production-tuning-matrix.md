# Production Tuning Matrix

This matrix captures practical defaults and observed trade-offs for Codivex retrieval/indexing.

## Qdrant HNSW
| Setting | Default | Effect | Trade-off |
|---|---:|---|---|
| `M` | 48 | Better recall at high scale | More memory and indexing time |
| `ef_construct` | 200 | Better graph quality | Slower indexing/build |
| `ef_search` | 64-200 | Higher recall on difficult semantic queries | Higher query latency |

## Quantization
| Mode | Memory | Latency | Recall impact |
|---|---|---|---|
| `none` | Highest | Baseline | Best quality |
| `int8` | ~4x smaller | Usually faster cache behavior | Small quality loss |
| `binary` | Up to ~16-32x smaller | Fast but workload-dependent | Highest quality risk |

## Retrieval Tier Controls
| Env | Values | Purpose |
|---|---|---|
| `MCP_RETRIEVAL_TIER` | `fast`, `hybrid`, `hybrid_rerank` | Switch retrieval strategy |
| `MCP_RERANK_TOP_N` | integer (default `20`) | Candidate depth for reranking |

## SLO Validation Controls
| Env | Default | Check |
|---|---:|---|
| `SLO_MAX_HYBRID_MS` | 45 | Hybrid query latency |
| `SLO_MAX_EMBEDDING_MS` | 20 | Query embedding latency |
| `SLO_MIN_THROUGHPUT_QPS` | 100 | Throughput estimate |
| `SLO_MAX_API_P50_MS` | 50 | Load test API p50 |
| `SLO_MAX_API_P95_MS` | 200 | Load test API p95 |

## Current Observed Matrix Runs
- Reports generated by:
  - `make bench-matrix`
  - output files in `benchmarks/matrix/`
- Quality run generated by:
  - `make quality-harness`
  - output file `benchmarks/quality-report.json`
